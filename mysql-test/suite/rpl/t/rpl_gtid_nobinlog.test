--let $rpl_topology=1->2
--source include/rpl_init.inc
--source include/have_binlog_format_statement.inc

--connection server_1
select @@global.log_slave_updates;

CREATE TABLE t1 (a INT PRIMARY KEY, b INT);
INSERT INTO t1 VALUES (1, 1);
INSERT INTO t1 VALUES (2, 1);
--save_master_pos

--connection server_2
select @@global.log_slave_updates;

--sync_with_master
SELECT * FROM t1 ORDER BY a;

--source include/stop_slave.inc

INSERT INTO t1 VALUES (3, 2);
INSERT INTO t1 VALUES (4, 2);

--source include/show_binlog_events.inc

--connection server_1
--replace_result $SLAVE_MYPORT SLAVE_PORT
eval CHANGE MASTER TO master_host = '127.0.0.1', master_port = $SLAVE_MYPORT,
     master_user = 'root', master_gtid_pos = AUTO;
START SLAVE;
--let $wait_condition= SELECT COUNT(*) = 4 FROM t1
--source include/wait_condition.inc

SELECT * FROM t1 ORDER BY a;

--source include/stop_slave.inc
RESET SLAVE;
INSERT INTO t1 VALUES (5, 1);
INSERT INTO t1 VALUES (6, 1);

--connection server_2
--replace_result $MASTER_MYPORT MASTER_PORT
eval CHANGE MASTER TO master_host = '127.0.0.1', master_port = $MASTER_MYPORT,
     master_gtid_pos = AUTO;
START SLAVE;
--let $wait_condition= SELECT COUNT(*) = 6 FROM t1
--source include/wait_condition.inc

SELECT * FROM t1 ORDER BY a;

# Cleanup.

--connection server_1
DROP TABLE t1;

--source include/rpl_end.inc
