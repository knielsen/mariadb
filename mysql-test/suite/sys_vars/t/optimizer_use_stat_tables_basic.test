--source include/load_sysvars.inc

#############################################################
#                 Save initial value                        #
#############################################################

SET @start_global_value = @@global.optimizer_use_stat_tables;
SELECT @start_global_value;
SET @start_session_value = @@session.optimizer_use_stat_tables;
SELECT @start_session_value;

###############################################################
#     Display the DEFAULT value of optimizer_use_stat_tables  #
###############################################################

SET @@global.optimizer_use_stat_tables = 2;
SET @@global.optimizer_use_stat_tables = DEFAULT;
SELECT @@global.optimizer_use_stat_tables;

SET @@session.optimizer_use_stat_tables = 3;
SET @@session.optimizer_use_stat_tables = DEFAULT;
SELECT @@session.optimizer_use_stat_tables;


##################################################################################
# Change the value ofoptimizer_use_stat_tables to a valid value for GLOBAL Scope #
##################################################################################

SET @@global.optimizer_use_stat_tables = 0;
SELECT @@global.optimizer_use_stat_tables;
SET @@global.optimizer_use_stat_tables = 1;
SELECT @@global.optimizer_use_stat_tables;
SET @@global.optimizer_use_stat_tables = 2;
SELECT @@global.optimizer_use_stat_tables;
SET @@global.optimizer_use_stat_tables = 3;
SELECT @@global.optimizer_use_stat_tables;

SET @@global.optimizer_use_stat_tables = NEVER;
SELECT @@global.optimizer_use_stat_tables;
SET @@global.optimizer_use_stat_tables = COMPLEMENTARY;
SELECT @@global.optimizer_use_stat_tables;
SET @@global.optimizer_use_stat_tables = PREFERABLY;
SELECT @@global.optimizer_use_stat_tables;
SET @@global.optimizer_use_stat_tables = EXCLUSIVELY;
SELECT @@global.optimizer_use_stat_tables;

####################################################################################
# Change the value of optimizer_use_stat_tables to a valid value for SESSION Scope #
####################################################################################

SET @@session.optimizer_use_stat_tables = 0;
SELECT @@session.optimizer_use_stat_tables;
SET @@session.optimizer_use_stat_tables = 1;
SELECT @@session.optimizer_use_stat_tables;
SET @@session.optimizer_use_stat_tables = 2;
SELECT @@session.optimizer_use_stat_tables;
SET @@session.optimizer_use_stat_tables = 3;
SELECT @@session.optimizer_use_stat_tables;

SET @@session.optimizer_use_stat_tables = NEVER;
SELECT @@session.optimizer_use_stat_tables;
SET @@session.optimizer_use_stat_tables = PREFERABLY;
SELECT @@session.optimizer_use_stat_tables;
SET @@session.optimizer_use_stat_tables = EXCLUSIVELY;
SELECT @@session.optimizer_use_stat_tables;
SET @@session.optimizer_use_stat_tables = COMPLEMENTARY;
SELECT @@session.optimizer_use_stat_tables;

#####################################################################
# Change the value of optimizer_use_stat_tables to an invalid value #
#####################################################################
set sql_mode=TRADITIONAL;
--Error ER_WRONG_VALUE_FOR_VAR
SET @@global.optimizer_use_stat_tables = 10;
--Error ER_WRONG_VALUE_FOR_VAR
SET @@global.optimizer_use_stat_tables = -1024;
--Error ER_WRONG_TYPE_FOR_VAR
SET @@global.optimizer_use_stat_tables = 2.4;
--Error ER_WRONG_VALUE_FOR_VAR
SET @@global.optimizer_use_stat_tables = OFF;
--Error ER_WRONG_VALUE_FOR_VAR
SET @@session.optimizer_use_stat_tables = 10;
--Error ER_WRONG_VALUE_FOR_VAR
SET @@session.optimizer_use_stat_tables = -2;
--Error ER_WRONG_TYPE_FOR_VAR
SET @@session.optimizer_use_stat_tables = 1.2;
--Error ER_WRONG_VALUE_FOR_VAR
SET @@session.optimizer_use_stat_tables = ON;

###############################################################################
#   Check if the value in GLOBAL & SESSION Tables matches value in variable   #
###############################################################################

SELECT * FROM INFORMATION_SCHEMA.GLOBAL_VARIABLES 
WHERE VARIABLE_NAME='optimizer_use_stat_tables';

SELECT * FROM INFORMATION_SCHEMA.SESSION_VARIABLES 
WHERE VARIABLE_NAME='optimizer_use_stat_tables';

####################################
#     Restore initial value        #
####################################

SET @@global.optimizer_use_stat_tables = @start_global_value;
SELECT @@global.optimizer_use_stat_tables;
SET @@session.optimizer_use_stat_tables = @start_session_value;
SELECT @@session.optimizer_use_stat_tables;
set sql_mode='';

######################################################
#         END OF optimizer_use_stat_tables TESTS     #
######################################################