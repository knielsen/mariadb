RESET MASTER;
# Connection default
CREATE TABLE t1 (a INT, b VARCHAR(100), PRIMARY KEY (a,b)) ENGINE=innodb;
SHOW MASTER STATUS;
File	Position	Binlog_Do_DB	Binlog_Ignore_DB
master-bin.000001	484		
SHOW STATUS LIKE 'binlog_snapshot_%';
Variable_name	Value
Binlog_snapshot_file	master-bin.000001
Binlog_snapshot_position	484
BEGIN;
INSERT INTO t1 VALUES (0, "");
# Connection con1
BEGIN;
INSERT INTO t1 VALUES (1, "");
# Connection con2
CREATE TABLE t2 (a INT PRIMARY KEY) ENGINE=myisam;
BEGIN;
INSERT INTO t1 VALUES (2, "first");
INSERT INTO t2 VALUES (2);
INSERT INTO t1 VALUES (2, "second");
# Connection default
COMMIT;
SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;
START TRANSACTION WITH CONSISTENT SNAPSHOT;
# Connection con3
BEGIN;
INSERT INTO t1 VALUES (3, "");
INSERT INTO t2 VALUES (3);
# Connection con4
BEGIN;
INSERT INTO t1 VALUES (4, "");
COMMIT;
# Connection default
SELECT * FROM t1 ORDER BY a,b;
a	b
0	
SHOW STATUS LIKE 'binlog_snapshot_%';
Variable_name	Value
Binlog_snapshot_file	master-bin.000001
Binlog_snapshot_position	986
SHOW MASTER STATUS;
File	Position	Binlog_Do_DB	Binlog_Ignore_DB
master-bin.000001	1338		
SELECT * FROM t2 ORDER BY a;
a
2
3
# Connection con1
COMMIT;
# Connection con2
COMMIT;
# Connection con3
COMMIT;
FLUSH LOGS;
# Connection default
SELECT * FROM t1 ORDER BY a,b;
a	b
0	
SHOW STATUS LIKE 'binlog_snapshot_%';
Variable_name	Value
Binlog_snapshot_file	master-bin.000001
Binlog_snapshot_position	986
SHOW MASTER STATUS;
File	Position	Binlog_Do_DB	Binlog_Ignore_DB
master-bin.000002	367		
COMMIT;
SHOW STATUS LIKE 'binlog_snapshot_%';
Variable_name	Value
Binlog_snapshot_file	master-bin.000002
Binlog_snapshot_position	367
SHOW MASTER STATUS;
File	Position	Binlog_Do_DB	Binlog_Ignore_DB
master-bin.000002	367		
SHOW BINLOG EVENTS;
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
master-bin.000001	4	Format_desc	1	248	Server ver: #, Binlog ver: #
master-bin.000001	248	Gtid_list	1	271	[]
master-bin.000001	271	Binlog_checkpoint	1	311	master-bin.000001
master-bin.000001	311	Gtid	1	349	GTID 0-1-1
master-bin.000001	349	Query	1	484	use `test`; CREATE TABLE t1 (a INT, b VARCHAR(100), PRIMARY KEY (a,b)) ENGINE=innodb
master-bin.000001	484	Gtid	1	522	GTID 0-1-2
master-bin.000001	522	Query	1	634	use `test`; CREATE TABLE t2 (a INT PRIMARY KEY) ENGINE=myisam
master-bin.000001	634	Gtid	1	672	BEGIN GTID 0-1-3
master-bin.000001	672	Query	1	760	use `test`; INSERT INTO t2 VALUES (2)
master-bin.000001	760	Query	1	829	COMMIT
master-bin.000001	829	Gtid	1	867	BEGIN GTID 0-1-4
master-bin.000001	867	Query	1	959	use `test`; INSERT INTO t1 VALUES (0, "")
master-bin.000001	959	Xid	1	986	COMMIT /* XID */
master-bin.000001	986	Gtid	1	1024	BEGIN GTID 0-1-5
master-bin.000001	1024	Query	1	1112	use `test`; INSERT INTO t2 VALUES (3)
master-bin.000001	1112	Query	1	1181	COMMIT
master-bin.000001	1181	Gtid	1	1219	BEGIN GTID 0-1-6
master-bin.000001	1219	Query	1	1311	use `test`; INSERT INTO t1 VALUES (4, "")
master-bin.000001	1311	Xid	1	1338	COMMIT /* XID */
master-bin.000001	1338	Gtid	1	1376	BEGIN GTID 0-1-7
master-bin.000001	1376	Query	1	1468	use `test`; INSERT INTO t1 VALUES (1, "")
master-bin.000001	1468	Xid	1	1495	COMMIT /* XID */
master-bin.000001	1495	Gtid	1	1533	BEGIN GTID 0-1-8
master-bin.000001	1533	Query	1	1630	use `test`; INSERT INTO t1 VALUES (2, "first")
master-bin.000001	1630	Query	1	1728	use `test`; INSERT INTO t1 VALUES (2, "second")
master-bin.000001	1728	Xid	1	1755	COMMIT /* XID */
master-bin.000001	1755	Gtid	1	1793	BEGIN GTID 0-1-9
master-bin.000001	1793	Query	1	1885	use `test`; INSERT INTO t1 VALUES (3, "")
master-bin.000001	1885	Xid	1	1912	COMMIT /* XID */
master-bin.000001	1912	Rotate	1	1956	master-bin.000002;pos=4
DROP TABLE t1,t2;
