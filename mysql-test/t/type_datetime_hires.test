
--source include/have_partition.inc

let type=datetime;
--source include/type_hrtime.inc

#
# partitioning
#
eval CREATE TABLE t1 (
  taken $type(5) NOT NULL DEFAULT '0000-00-00 00:00:00',
  id int(11) NOT NULL DEFAULT '0',
  PRIMARY KEY (id,taken),
  KEY taken (taken)
)
PARTITION BY RANGE (to_days(taken))
(
PARTITION p01 VALUES LESS THAN (732920),
PARTITION p02 VALUES LESS THAN (732950),
PARTITION p03 VALUES LESS THAN MAXVALUE);

INSERT INTO t1 VALUES
('2006-09-27 21:50:01.123456',0),
('2006-09-27 21:50:01.123456',1),
('2006-09-27 21:50:01.123456',2),
('2006-09-28 21:50:01.123456',3),
('2006-09-29 21:50:01.123456',4),
('2006-09-29 21:50:01.123456',5),
('2006-09-30 21:50:01.123456',6),
('2006-10-01 21:50:01.123456',7),
('2006-10-02 21:50:01.123456',8),
('2006-10-02 21:50:01.123456',9);

SELECT id,to_days(taken) FROM t1 order by 2;

eval CREATE TABLE t2 (
  taken $type(5) NOT NULL DEFAULT '0000-00-00 00:00:00',
  id int(11) NOT NULL DEFAULT '0',
  PRIMARY KEY (id,taken),
  KEY taken (taken)
)
PARTITION BY RANGE (extract(microsecond from taken))
(
PARTITION p01 VALUES LESS THAN (123000),
PARTITION p02 VALUES LESS THAN (500000),
PARTITION p03 VALUES LESS THAN MAXVALUE);

INSERT INTO t2 VALUES
('2006-09-27 21:50:01',0),
('2006-09-27 21:50:01.1',1),
('2006-09-27 21:50:01.12',2),
('2006-09-28 21:50:01.123',3),
('2006-09-29 21:50:01.1234',4),
('2006-09-29 21:50:01.12345',5),
('2006-09-30 21:50:01.123456',6),
('2006-10-01 21:50:01.56',7),
('2006-10-02 21:50:01.567',8),
('2006-10-02 21:50:01.5678',9);

select table_name,partition_name,partition_method,partition_expression,partition_description,table_rows from information_schema.partitions where table_name in ('t1', 't2');

drop table t1, t2;

#
# insert ... select with conversion
#
create table t1 (
 q_date date,
 q_time time,
 q_time5 time(5),
 q_datetime datetime,
 q_datetime1 datetime(1),
 q_datetime3 datetime(3),
 q_datetime5 datetime(5),
 q_timestamp timestamp,
 q_timestamp2 timestamp(2),
 q_timestamp4 timestamp(4),
 q_timestamp6 timestamp(6),
 q_varchar50 varchar(50),
 q_varchar60 varchar(60),
 q_varchar70 varchar(70),
 q_varchar80 varchar(80));

create table t2 (
 date_datetime datetime,
 time_datetime datetime,
 time5_varchar100 varchar(100),
 datetime_time time,
 datetime1_date  date,
 datetime3_timestamp timestamp,
 datetime5_varchar100 varchar(100),
 timestamp_datetime datetime,
 timestamp2_date date,
 timestamp4_time time,
 timestamp6_varchar100 varchar(100),
 varchar50_date date,
 varchar60_datetime datetime,
 varchar70_time time,
 varchar80_timestamp timestamp);

insert t1 values ('2010-11-12 11:14:17.765432',
                  '2010-11-12 11:14:17.765432', '2010-11-12 11:14:17.765432',
                  '2010-11-12 11:14:17.765432', '2010-11-12 11:14:17.765432',
                  '2010-11-12 11:14:17.765432', '2010-11-12 11:14:17.765432',
                  '2010-11-12 11:14:17.765432', '2010-11-12 11:14:17.765432',
                  '2010-11-12 11:14:17.765432', '2010-11-12 11:14:17.765432',
                  '2010-11-12 11:14:17.765432', '2010-11-12 11:14:17.765432',
                  '2010-11-12 11:14:17.765432', '2010-11-12 11:14:17.765432');
--query_vertical select * from t1;
insert t2 select * from t1;
--query_vertical select * from t2;
alter table t1
 change q_date date_datetime datetime,
 change q_time time_datetime datetime,
 change q_time5 time5_varchar100 varchar(100),
 change q_datetime datetime_time time,
 change q_datetime1 datetime1_date  date,
 change q_datetime3 datetime3_timestamp timestamp,
 change q_datetime5 datetime5_varchar100 varchar(100),
 change q_timestamp timestamp_datetime datetime,
 change q_timestamp2 timestamp2_date date,
 change q_timestamp4 timestamp4_time time,
 change q_timestamp6 timestamp6_varchar100 varchar(100),
 change q_varchar50 varchar50_date date,
 change q_varchar60 varchar60_datetime datetime,
 change q_varchar70 varchar70_time time,
 change q_varchar80 varchar80_timestamp timestamp;
--query_vertical select * from t1;

drop table t1, t2;

create table t1 (a datetime, b datetime(6));
insert t1 values ('2010-01-02 03:04:05.678912', '2010-01-02 03:04:05.678912');
update t1 set b=a;
select * from t1;
drop table t1;

